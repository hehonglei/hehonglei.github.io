<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
        QQ群红包的算法实现探讨（基于PHP demo）     &middot; 可了头i的博客
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/naringu.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/form.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="./public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="Mozilla RSS" href="feed.category.xml">
  </head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48740529-1', 'auto');
  ga('send', 'pageview');

</script>


<body class="theme-6dd">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <img width="125" height="125" alt="A photo of ariestiyansyah" src="/images/head.jpeg">
    <p>oonlab is crafted with <3 by ariestiyansyah.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/categories/">Category Index</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/contact/">Contact</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="http://github.com">GitHub project</a>
    <span class="sidebar-nav-item">Version 2.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">可了头i的博客</a>
            <small>A GOOD MAN</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">  QQ群红包的算法实现探讨（基于PHP demo）    </h1>
  <span class="post-date">05 Feb 2010</span>
  <p>这个算法需要满足以下几点要求：</p>

<p>1、每个人都要能够领取到红包；</p>

<p>2、每个人领取到的红包金额总和=总金额；</p>

<p>3、每个人领取到的红包金额不等，但也不能差的太离谱，不然就没趣味；</p>

<p>4、算法一定要简单，不然对不起腾讯这个招牌；</p>

<p>正式编码之前，先搭建一个递进的模型来分析规律
[php]</p>

<pre><code>设定总金额为10元，有N个人随机领取：  
N=1   
则红包金额=X元；   
  
N=2   
为保证第二个红包可以正常发出，第一个红包金额=0.01至9.99之间的某个随机数   
第二个红包=10-第一个红包金额；   
  
N=3   
红包1=0.01至0.98之间的某个随机数   
红包2=0.01至(10-红包1-0.01)的某个随机数   
红包3=10-红包1-红包2   
  
……  
</code></pre>

<p>至此，规律出现啦！开始编码！
[php]</p>

<pre><code>header("Content-Type: text/html;charset=utf-8");//输出不乱码，你懂的    
$total=10;//红包总额    
$num=8;// 分成8个红包，支持8人随机领取    
$min=0.01;//每个人最少能收到0.01元    
        
for ($i=1;$i&lt;$num;$i++)    
  {    
      $safe_total=$total-($num-$i)*$min;//随机安全上限    
      $money=mt_rand($min*100,$safe_total*100)/100;    
      $total=$total-$money;    
      echo '第'.$i.'个红包：'.$money.' 元，余额：'.$total.' 元 &lt;br/&gt;';    
  }    
 echo '第'.$num.'个红包：'.$total.' 元，余额：0 元';    
</code></pre>

<p>输入一看，波动太大，这数据太无趣了！
[php]</p>

<pre><code>第1个红包：7.48 元，余额：2.52 元   
第2个红包：1.9 元，余额：0.62 元   
第3个红包：0.49 元，余额：0.13 元   
第4个红包：0.04 元，余额：0.09 元   
第5个红包：0.03 元，余额：0.06 元   
第6个红包：0.03 元，余额：0.03 元   
第7个红包：0.01 元，余额：0.02 元   
第8个红包：0.02 元，余额：0 元  
</code></pre>

<p>改良一下，将平均值作为随机安全上限来控制波动差</p>

<p>[php]</p>

<pre><code>header("Content-Type: text/html;charset=utf-8");//输出不乱码，你懂的    
$total=10;//红包总额    
$num=8;// 分成8个红包，支持8人随机领取    
$min=0.01;//每个人最少能收到0.01元    
        
for ($i=1;$i&lt;$num;$i++)    
{    
    $safe_total=($total-($num-$i)*$min)/($num-$i);//随机安全上限    
    $money=mt_rand($min*100,$safe_total*100)/100;    
    $total=$total-$money;    
    echo '第'.$i.'个红包：'.$money.' 元，余额：'.$total.' 元 &lt;br/&gt;';    
}    
  echo '第'.$num.'个红包：'.$total.' 元，余额：0 元';    
</code></pre>

<p>输出结果见下图
[php]</p>

<pre><code>第1个红包：0.06 元，余额：9.94 元   
第2个红包：1.55 元，余额：8.39 元   
第3个红包：0.25 元，余额：8.14 元   
第4个红包：0.98 元，余额：7.16 元   
第5个红包：1.88 元，余额：5.28 元   
第6个红包：1.92 元，余额：3.36 元   
第7个红包：2.98 元，余额：0.38 元   
第8个红包：0.38 元，余额：0 元  
</code></pre>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/mvc/2016/09/01/mvc-talk-lightly/">
            浅谈MVC架构模式分析与设计
            <small>01 Sep 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/php/2016/08/05/php-thing/">
            PHP事物处理
            <small>05 Aug 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/php/2016/08/03/magic-methods/">
            PHP魔术方法
            <small>03 Aug 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'testnaringu';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'testnaringu';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

    <div align="center" class="footer">
        <a href="https://github.com/ariestiyansyah/naringu" target="_blank" title="naringu">Naringu</a>  is designed by Rizky Ariestiyansyah<br />Copyright © 2016 <br>
    </div>
  </body>
</html>

